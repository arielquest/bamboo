SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [dbo].[VW_FCT_CASE_RESOLUTION_CUBE]
AS
SELECT 
    x.[PARTITION_URN],
    x.[PARTITION_ID], 
    x.[CLUSTER_RESOURCE_URN],
    x.[FIRST_TENANT_URN],
    x.[FINAL_TENANT_URN],
    x.[FIRST_ACTIVITY_TYPE_CODE_URN],
    x.[FINAL_ACTIVITY_TYPE_CODE_URN],
    x.[CASE_URN],
    x.[CUSTOMER_URN],
    x.[FIRST_AGENT_URN],
    x.[FINAL_AGENT_URN],
    x.[FIRST_MANAGER_AGENT_URN],
    x.[FINAL_MANAGER_AGENT_URN],
    x.[FIRST_AGENT_TEAM_URN],
    x.[FINAL_AGENT_TEAM_URN],
    x.[FIRST_PERSON_URN],
    x.[FINAL_PERSON_URN],
    x.[FIRST_QUEUE_URN],
    x.[FINAL_QUEUE_URN],
    x.[FIRST_CLASSIFICATION_CATEGORY_URN],
    x.[FINAL_CLASSIFICATION_CATEGORY_URN],
    x.[FIRST_RESOLUTION_CODE_CATEGORY_URN],
    x.[FINAL_RESOLUTION_CODE_CATEGORY_URN],
    x.[FIRST_VIEWED_KB_FOLDER_URN], 
    x.[FINAL_VIEWED_KB_FOLDER_URN], 
    x.[FIRST_VIEWED_KB_PORTAL_URN], 
    x.[FINAL_VIEWED_KB_PORTAL_URN], 
    x.[FIRST_VIEWED_KB_TOPIC_URN], 
    x.[FINAL_VIEWED_KB_TOPIC_URN], 
    x.[FIRST_VIEWED_KB_ARTICLE_URN], 
    x.[FINAL_VIEWED_KB_ARTICLE_URN], 
    x.[FIRST_KNOWLEDGE_VIEWED_BOOLEAN_VALUE_URN],
    x.[FINAL_KNOWLEDGE_VIEWED_BOOLEAN_VALUE_URN],
    x.[FIRST_USED_KB_FOLDER_URN], 
    x.[FINAL_USED_KB_FOLDER_URN], 
    x.[FIRST_USED_KB_ARTICLE_URN], 
    x.[FINAL_USED_KB_ARTICLE_URN], 
    x.[FIRST_KNOWLEDGE_USED_BOOLEAN_VALUE_URN],
    x.[FINAL_KNOWLEDGE_USED_BOOLEAN_VALUE_URN],
    x.[CASE_REOPEN_SEQUENCE_NUMBER], 
    x.[CASE_ACTIVITY_SEQUENCE_NUMBER],

    x.[FINAL_DATE_UTC_URN],
    x.[FINAL_TIME_UTC_URN],
    tzd.[OLAP_DATETIME_UTC] AS [DATETIME_UTC_URN],  
    tzd.[OLAP_DATETIME_TIMEZONE_0] AS [TIME_ZONE_0_URN],
    tzd.[OLAP_DATETIME_TIMEZONE_1] AS [TIME_ZONE_1_URN],
    tzd.[OLAP_DATETIME_TIMEZONE_2] AS [TIME_ZONE_2_URN],
    tzd.[OLAP_DATETIME_TIMEZONE_3] AS [TIME_ZONE_3_URN],
    tzd.[OLAP_DATETIME_TIMEZONE_4] AS [TIME_ZONE_4_URN],
    tzd.[OLAP_DATETIME_TIMEZONE_5] AS [TIME_ZONE_5_URN],
    tzd.[OLAP_DATETIME_TIMEZONE_6] AS [TIME_ZONE_6_URN],
    tzd.[OLAP_DATETIME_TIMEZONE_7] AS [TIME_ZONE_7_URN],
    tzd.[OLAP_DATETIME_TIMEZONE_8] AS [TIME_ZONE_8_URN],
    tzd.[OLAP_DATETIME_TIMEZONE_9] AS [TIME_ZONE_9_URN],
    tzd.[OLAP_DATETIME_TIMEZONE_10] AS [TIME_ZONE_10_URN],
    tzd.[OLAP_DATETIME_TIMEZONE_11] AS [TIME_ZONE_11_URN],
    tzd.[OLAP_DATETIME_TIMEZONE_12] AS [TIME_ZONE_12_URN],
    tzd.[OLAP_DATETIME_TIMEZONE_13] AS [TIME_ZONE_13_URN],
    tzd.[OLAP_DATETIME_TIMEZONE_14] AS [TIME_ZONE_14_URN],
    tzd.[OLAP_DATETIME_TIMEZONE_15] AS [TIME_ZONE_15_URN],
    tzd.[OLAP_DATETIME_TIMEZONE_16] AS [TIME_ZONE_16_URN],
    tzd.[OLAP_DATETIME_TIMEZONE_17] AS [TIME_ZONE_17_URN],
    tzd.[OLAP_DATETIME_TIMEZONE_18] AS [TIME_ZONE_18_URN],
    tzd.[OLAP_DATETIME_TIMEZONE_19] AS [TIME_ZONE_19_URN],

    CAST(x.[CASE_FCR_CNTR] AS BIGINT) AS [Case Fcr Counter],
    CAST(x.[CASE_NON_FCR_CNTR] AS BIGINT) AS [Case Non Fcr Counter],
    CAST(x.[CASE_REWORK_TIME] AS BIGINT) AS [Case Rework Time],
    
    CAST(x.[FIRST_CLOSE_CASE_CNTR] AS BIGINT) AS [First Close Case Counter],
    CAST(x.[FIRST_CLOSE_CASE_REOPEN_CNTR] AS BIGINT) AS [First Close Case Reopen Counter],
    CAST(x.[REPEAT_CLOSE_CASE_CNTR] AS BIGINT) AS [Repeat Close Case Counter],
    CAST(x.[REPEAT_CLOSE_CASE_REOPEN_CNTR] AS BIGINT) AS [Repeat Close Case Reopen Counter],

    x.[CUSTOM_ATTRIBUTE_0] AS [CUSTOM_ATTRIBUTE_0],
    x.[CUSTOM_ATTRIBUTE_1] AS [CUSTOM_ATTRIBUTE_1],
    x.[CUSTOM_ATTRIBUTE_2] AS [CUSTOM_ATTRIBUTE_2],
    x.[CUSTOM_ATTRIBUTE_3] AS [CUSTOM_ATTRIBUTE_3],
    x.[CUSTOM_ATTRIBUTE_4] AS [CUSTOM_ATTRIBUTE_4],
    x.[CUSTOM_ATTRIBUTE_5] AS [CUSTOM_ATTRIBUTE_5],
    x.[CUSTOM_ATTRIBUTE_6] AS [CUSTOM_ATTRIBUTE_6],
    x.[CUSTOM_ATTRIBUTE_7] AS [CUSTOM_ATTRIBUTE_7],
    x.[CUSTOM_ATTRIBUTE_8] AS [CUSTOM_ATTRIBUTE_8],
    x.[CUSTOM_ATTRIBUTE_9] AS [CUSTOM_ATTRIBUTE_9],
    CAST(x.[CUSTOM_MEASURE_0] AS BIGINT) AS [Custom Measure 0],  
    CAST(x.[CUSTOM_MEASURE_1] AS BIGINT) AS [Custom Measure 1],  
    CAST(x.[CUSTOM_MEASURE_2] AS BIGINT) AS [Custom Measure 2],  
    CAST(x.[CUSTOM_MEASURE_3] AS BIGINT) AS [Custom Measure 3],  
    CAST(x.[CUSTOM_MEASURE_4] AS BIGINT) AS [Custom Measure 4],  
    CAST(x.[CUSTOM_MEASURE_5] AS BIGINT) AS [Custom Measure 5],  
    CAST(x.[CUSTOM_MEASURE_6] AS BIGINT) AS [Custom Measure 6],  
    CAST(x.[CUSTOM_MEASURE_7] AS BIGINT) AS [Custom Measure 7],  
    CAST(x.[CUSTOM_MEASURE_8] AS BIGINT) AS [Custom Measure 8],  
    CAST(x.[CUSTOM_MEASURE_9] AS BIGINT) AS [Custom Measure 9],
    x.[Row Count]
FROM [dbo].[VW_FCT_CASE_RESOLUTION] x
INNER JOIN [dbo].[VW_DIM_TIME_STD_CUBE] tt ON x.[FINAL_TIME_UTC_URN] = tt.[TIME_URN]  
INNER JOIN [dbo].[TS_ADM_TIME_ZONE_DATA] tzd ON tzd.[DATE_UTC_URN] = x.[FINAL_DATE_UTC_URN] AND tzd.[TIME_UTC_URN] = tt.[QUARTER_HOUR_URN];
GO
GRANT SELECT
	ON [dbo].[VW_FCT_CASE_RESOLUTION_CUBE]
	TO [portalapp_role]
GO

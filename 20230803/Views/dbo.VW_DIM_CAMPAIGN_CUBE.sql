SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [dbo].[VW_DIM_CAMPAIGN_CUBE]
WITH SCHEMABINDING
AS
SELECT  it.[ITEM_URN],
        it.[ITEM_BIZ_URN],
        CAST('00001600-1000-0000-0000-000000000010' AS UNIQUEIDENTIFIER) AS [ITEM_TYPE_ID],
        it.[ITEM_SUBTYPE_ID],
        it.[OWNER_ID],
        it.[FOLDER_ID],
        fl.[PARENT_ID] AS [FOLDER_PARENT_ID],
        fl.[FOLDER_TYPE],
        fl.[DEPTH] AS [FOLDER_DEPTH],
        fl.[NAME] AS [FOLDER_NAME],
        fl.[FOLDER_URN],
        it.[NAME],
        COALESCE(NULLIF(RTRIM(LTRIM(pk.[INTERNAL_NAME])), ''), pk.[PKEY1],
                 'Not Known') AS [INTERNAL_NAME],
        COALESCE(pk.[PKEY1], '') AS [PKEY1],
        COALESCE(pk.[ABANDON_ENABLED], 0) AS [ABANDON_ENABLED],
        COALESCE(pk.[ABANDON_PERCENT], -1) AS [ABANDON_PERCENT],
        COALESCE(pk.[NO_ANSWER_CALLBACK], -1) AS [NO_ANSWER_CALLBACK],
        COALESCE(pk.[BUSY_CALLBACK], -1) AS [BUSY_CALLBACK],
        COALESCE(pk.[NO_ANSWER_RING_LIMIT], -1) AS [NO_ANSWER_RING_LIMIT],
        COALESCE(pk.[MAXIMUM_LINE_AGENT], -1) AS [MAXIMUM_LINE_AGENT],
        COALESCE(pk.[LINES_PER_AGENT], -1) AS [LINES_PER_AGENT],
        COALESCE(pk.[LEAVE_MESSAGE_ENABLED], 0) AS [LEAVE_MESSAGE_ENABLED],
        COALESCE(pk.[MAXIMUM_ATTEMPTS], -1) AS [MAXIMUM_ATTEMPTS],
        COALESCE(pk.[WORK_START_HOURS], -1) AS [WORK_START_HOURS],
        COALESCE(pk.[WORK_START_MINUTES], -1) AS [WORK_START_MINUTES],
        COALESCE(pk.[WORK_END_HOURS], -1) AS [WORK_END_HOURS],
        COALESCE(pk.[WORK_END_MINUTES], -1) AS [WORK_END_MINUTES],
        COALESCE(pk.[HOME_START_HOURS], -1) AS [HOME_START_HOURS],
        COALESCE(pk.[HOME_START_MINUTES], -1) AS [HOME_START_MINUTES],
        COALESCE(pk.[HOME_END_HOURS], -1) AS [HOME_END_HOURS],
        COALESCE(pk.[HOME_END_MINUTES], -1) AS [HOME_END_MINUTES],
        COALESCE(pk.[HOME_ENABLED], 0) AS [HOME_ENABLED],
        COALESCE(pk.[WORK_ENABLED], 0) AS [WORK_ENABLED],
        COALESCE(pk.[BUSY_RETRY_ENABLED], 0) AS [BUSY_RETRY_ENABLED],
        COALESCE(pk.[MAXIMUM_BUSY_ATTEMPTS], -1) AS [MAXIMUM_BUSY_ATTEMPTS],
        COALESCE(pk.[ANSWER_DETECT_ENABLED], 0) AS [ANSWER_DETECT_ENABLED],
        COALESCE(pk.[CALLBACK_TIME_LIMIT], -1) AS [CALLBACK_TIME_LIMIT],
        COALESCE(pk.[MINIMUM_CALL_DURATION], -1) AS [MINIMUM_CALL_DURATION],
        COALESCE(pk.[EXHAUSTED_CALLS_ENABLED], 0) AS [EXHAUSTED_CALLS_ENABLED],
        COALESCE(pk.[EDGE_DETECT_ENABLED], 0) AS [EDGE_DETECT_ENABLED],
        COALESCE(pk.[QUICK_DETECT_ENABLED], 0) AS [QUICK_DETECT_ENABLED],
        COALESCE(pk.[SP_CLOSED_RECORD_ENABLED], 0) AS [SP_CLOSED_RECORD_ENABLED],
        COALESCE(pk.[SP_CLOSED_RECORD_COUNT], -1) AS [SP_CLOSED_RECORD_COUNT],
        COALESCE(pk.[PERSONALIZED_CALLBACK_ENABLED], 0) AS [PERSONALIZED_CALLBACK_ENABLED],
        COALESCE(pk.[RELEASE_CALLBACK_ENABLED], 0) AS [RELEASE_CALLBACK_ENABLED],
        COALESCE(pk.[RESCHEDULE_CALLBACK_MODE], -1) AS [RESCHEDULE_CALLBACK_MODE],
        COALESCE(pk.[IP_TERMINATING_BEEP_DETECT], 0) AS [IP_TERMINATING_BEEP_DETECT],
        COALESCE(pk.[CAMPAIGN_PURPOSE_TYPE], -1) AS [CAMPAIGN_PURPOSE_TYPE],
        COALESCE(pk.[IPAMD_ENABLED], 0) AS [IPAMD_ENABLED],
        COALESCE(pk.[AMD_TREATMENT_MODE], -1) AS [AMD_TREATMENT_MODE],
        COALESCE(pk.[USE_GMT_FROM_REGION_PREFIX], 0) AS [USE_GMT_FROM_REGION_PREFIX],
        COALESCE(pk.[CONFIG_PARAM], '') AS [CONFIG_PARAM],
        COALESCE(pk.[ABANDON_CUSTOMER_CALLBACK], -1) AS [ABANDON_CUSTOMER_CALLBACK],
        COALESCE(pk.[ABANDONED_DIALER_CALLBACK], -1) AS [ABANDONED_DIALER_CALLBACK],
        COALESCE(pk.[CUSTOMER_NOT_HOME_CALLBACK], -1) AS [CUSTOMER_NOT_HOME_CALLBACK],
        COALESCE(pk.[ANSWERING_MACHINE_CALLBACK], -1) AS [ANSWERING_MACHINE_CALLBACK],
        COALESCE(pk.[PREFIX_DIGITS], '') AS [PREFIX_DIGITS],
        COALESCE(pk.[WAIT_FOR_BUSY_RETRY], 0) AS [WAIT_FOR_BUSY_RETRY],
        COALESCE(pk.[DISABLE_CPA], 0) AS [DISABLE_CPA],
        COALESCE(pk.[DST_LOCATION], -1) AS [DST_LOCATION],
        COALESCE(pk.[ICM_ENABLED], 0) AS [ICM_ENABLED],
        COALESCE(REPLACE(REPLACE(REPLACE(it.[DESCRIPTION], CHAR(9), ''),
                                 CHAR(13), ''), CHAR(10), ''), '') COLLATE Latin1_General_100_CI_AS_SC AS [DESCRIPTION],
        it.[EFFECTIVE_FROM],
        it.[EFFECTIVE_TO],
        it.[HIERARCHY_PARENT_URN],
        it.[TIME_ZONE_URN],
        it.[SKIP_LEVEL],
        it.[DELETED],
        it.[HIDDEN],
        it.[SYSTEM],
        it.[LATEST],
        it.[CHANGE_STAMP]
FROM    [dbo].[TB_DIM_CAMPAIGN] it
LEFT JOIN [dbo].[TB_DIM_CAMPAIGN_PKEY_MAP] pk ON it.[ITEM_BIZ_URN] = pk.[ITEM_BIZ_URN]
                                                 AND pk.[LATEST] = 1
JOIN    [dbo].[TB_SEC_FOLDER] fl ON fl.[FOLDER_ID] = it.[FOLDER_ID]
UNION ALL
SELECT  e.[ITEM_BIZ_URN] AS [ITEM_URN],
        e.[ITEM_BIZ_URN] AS [ITEM_BIZ_URN],
        e.[ITEM_TYPE_ID] AS [ITEM_TYPE_ID],
        NULL AS [ITEM_SUBTYPE_ID],
        NULL AS [OWNER_ID],
        NULL AS [FOLDER_ID],
        NULL AS [FOLDER_PARENT_ID],
        '' AS [FOLDER_TYPE],
        CAST(0 AS TINYINT) AS [FOLDER_DEPTH],
        'Deleted Dimensions' AS [FOLDER_NAME],
        -1 AS [FOLDER_URN],
        'Deleted Campaign ' + CAST(e.[ITEM_BIZ_URN] AS NVARCHAR(10)) AS [NAME],
        'Deleted Campaign ' + CAST(e.[ITEM_BIZ_URN] AS NVARCHAR(10)) AS [INTERNAL_NAME],
        '' AS [PKEY1],
        0 AS [ABANDON_ENABLED],
        -1 AS [ABANDON_PERCENT],
        -1 AS [NO_ANSWER_CALLBACK],
        -1 AS [BUSY_CALLBACK],
        -1 AS [NO_ANSWER_RING_LIMIT],
        -1 AS [MAXIMUM_LINE_AGENT],
        -1 AS [LINES_PER_AGENT],
        0 AS [LEAVE_MESSAGE_ENABLED],
        -1 AS [MAXIMUM_ATTEMPTS],
        -1 AS [WORK_START_HOURS],
        -1 AS [WORK_START_MINUTES],
        -1 AS [WORK_END_HOURS],
        -1 AS [WORK_END_MINUTES],
        -1 AS [HOME_START_HOURS],
        -1 AS [HOME_START_MINUTES],
        -1 AS [HOME_END_HOURS],
        -1 AS [HOME_END_MINUTES],
        0 AS [HOME_ENABLED],
        0 AS [WORK_ENABLED],
        0 AS [BUSY_RETRY_ENABLED],
        -1 AS [MAXIMUM_BUSY_ATTEMPTS],
        0 AS [ANSWER_DETECT_ENABLED],
        -1 AS [CALLBACK_TIME_LIMIT],
        -1 AS [MINIMUM_CALL_DURATION],
        0 AS [EXHAUSTED_CALLS_ENABLED],
        0 AS [EDGE_DETECT_ENABLED],
        0 AS [QUICK_DETECT_ENABLED],
        0 AS [SP_CLOSED_RECORD_ENABLED],
        -1 AS [SP_CLOSED_RECORD_COUNT],
        0 AS [PERSONALIZED_CALLBACK_ENABLED],
        0 AS [RELEASE_CALLBACK_ENABLED],
        -1 AS [RESCHEDULE_CALLBACK_MODE],
        0 AS [IP_TERMINATING_BEEP_DETECT],
        -1 AS [CAMPAIGN_PURPOSE_TYPE],
        0 AS [IPAMD_ENABLED],
        -1 AS [AMD_TREATMENT_MODE],
        0 AS [USE_GMT_FROM_REGION_PREFIX],
        '' AS [CONFIG_PARAM],
        -1 AS [ABANDON_CUSTOMER_CALLBACK],
        -1 AS [ABANDONED_DIALER_CALLBACK],
        -1 AS [CUSTOMER_NOT_HOME_CALLBACK],
        -1 AS [ANSWERING_MACHINE_CALLBACK],
        '' AS [PREFIX_DIGITS],
        0 AS [WAIT_FOR_BUSY_RETRY],
        0 AS [DISABLE_CPA],
        -1 AS [DST_LOCATION],
        0 AS [ICM_ENABLED],
        'This dimension does not exist in VIM anymore.' AS [DESCRIPTION],
        '1900-01-01 00:00:00.000' AS [EFFECTIVE_FROM],
        '2079-06-06 00:00:00.000' AS [EFFECTIVE_TO],
        NULL AS [HIERARCHY_PARENT_URN],
        2 AS [TIME_ZONE_URN],
        NULL AS [SKIP_LEVEL],
        CAST(0 AS BIT) AS [DELETED],
        CAST(0 AS BIT) AS [HIDDEN],
        CAST(0 AS BIT) AS [SYSTEM],
        CAST(0 AS BIT) AS [LATEST],
        0 AS [CHANGE_STAMP]
FROM    [dbo].[TS_IMP_OLAP_DIMENSION_IN_ERROR] AS e
WHERE   e.[ITEM_TYPE_URN] = 13;
GO
GRANT SELECT
	ON [dbo].[VW_DIM_CAMPAIGN_CUBE]
	TO [portalapp_role]
GO
